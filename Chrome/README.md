# Learning V8
## workflow
1. https://speakerdeck.com/brn/source-to-binary-journey-of-v8-javascript-engine-english-version 
2. http://eternalsakura13.com/2018/06/16/nodefest_v8/

## Object Representation
1. https://v8.dev/blog/fast-properties
2. http://www.jayconrod.com/posts/52/a-tour-of-v8--object-representation

## Optimization and de-optimization
1. https://juejin.im/post/59f95af951882574d1723e70#heading-8 

## Build V8
1. https://medium.com/dailyjs/how-to-build-v8-on-windows-and-not-go-mad-6347c69aacd4
2. http://eternalsakura13.com/2018/06/26/v8_environment/
3. http://blog.gclxry.com/use-depot_tools-to-manage-chromium-source/ (介绍depot_tools)

```
cd ~/v8/v8
git reset --hard a7a350012c05f644f3f373fb48d7ac72f7f60542
gclient sync
tools/dev/v8gen.py x64.debug 
ninja -C out.gn/x64.debug 
```

# 知识点

# 调试

## D8
1. https://github.com/Nathanaela/v8-Natives/blob/master/lib/v8-native-calls.js (v8 internal methods)
2. https://gist.github.com/kevincennis/0cd2138c78a07412ef21 (D8用法)

*** print-opt-code之类的，release版本D8 shell是不支持的 ***

*** print-bytecode也得在支持Ignition的V8里使用啊，之前都不生成bytecode啊。。。似乎Chrome59才支持的 *** 

```
--trace-opt 
--trace-deopt
--trace-opt-verbose
--allow-natives-syntax
--code-comments
--print-opt-code
--trace-elements-transitions

%DebugPrint 
%OptimizeFunctionOnNextCall

```

超好用的调试技巧
```
// %DebugPrint 可以打印出变量信息，包括地址、结构； while(1)则方便调试器attach
var a = [0xdeadbee, 0xdeadbee, 0xdeadbee];
%DebugPrint(a);
while(1);

```
![](README/README17.png)





## Object 内存布局
参考：
http://eternalsakura13.com/2018/05/06/v8/

```
<html>
<script>
    var a = [0xdeadbee, 0xdeadbeef, 4.231256, "testtesttestcy", true, false, null, undefined]
    alert("1111");
</script>
</html>

```
1. Small Int
![](README/README0.png)
![](README/README1.png)

2. HeapNumber (超过Small Int范围的Int、Double)
首先，数组中存放的是HeapObject指针

![](README/README2.png)

HeapNumber结构
![](README/README3.png)

调试如下：
![](README/README4.png)

![](README/README5.png)

3. PropertyCell
不知道是啥，先记着

![](README/README6.png)

4. String
![](README/README7.png)

![](README/README8.png)

5. Oddball, 没调出来。。。
表示特殊值的对象，例如true，false，undefined, null

![](README/README9.png)

6. JSObject, 没调出来
![](README/README10.png)

7. JSFunction, 没调出来
![](README/README11.png)

8. JSArray
![](README/README12.png)
![](README/README13.png)


9. JSArrayBuffer
![](README/README16.png)

![](README/README15.png)

![](README/README14.png)
