# Part0: HackNotes

** Just some reading notes when reading other people's stuff. **

## [Introduction to Win32 shellcoding](https://www.corelan.be/index.php/2010/02/25/exploit-writing-tutorial-part-9-introduction-to-win32-shellcoding/)

1. Shellcode exitfunc
```
3 techniques that can be used to exit the shellcode with :
process : this will use ExitProcess()
seh : this one will force an exception call.�� Keep in mind that this one might trigger the exploit code to run over and over again (if the original bug was SEH based for example)
thread : this will use ExitThread()
```

2. Find yourself : Get Program Counter
Normaly, payload decoder needs to get the absolute base address at first. That's called "Get PC".

- CALL $+5  (contain null bytes)
```
CALL $+5  # e800000000
POP EAX   # 58
```

- CALL label + pop  (contain null bytes)
 ```
 CALL geteip
 geteip:
 pop eax
 ```

- CALL $+4 (no null bytes)

```
CALL $+4 #\xe8\xff\xff\xff\xff
RET      #\xc3
POP ECX  #\x59
```


- FSTENV (no null bytes)

Execute any FPU (Floating Point) instruction at the top of the code, then execute "FSTENV PTR SS: [ESP-C]"

the FSTENV will store that state of the floating point chip which includes the address of that first instruction.

```
[BITS 32]
FLDPI
FSTENV [ESP-0xC]
POP EBX
```


- Backward call(no null bytes)
```
[BITS 32]
jmp short corelan
geteip:
  pop esi
  call esi      ;this will jump to decoder
corelan:
  call geteip
  decoder:      
    ; decoder goes here

  shellcode:
    ; encoded shellcode goes here
```

